<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Create AI Voice Agent</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen',
                'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #e9ecef 100%);
            min-height: 100vh;
            padding: 2rem;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 16px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.07);
            padding: 2rem;
        }

        .header {
            position: relative;
            margin-bottom: 2rem;
            padding-bottom: 1.5rem;
            border-bottom: 1px solid #e9ecef;
        }

        h1 {
            font-size: 1.75rem;
            font-weight: 600;
            color: #1a1a1a;
            margin: 0 0 0.5rem 0;
            text-align: center;
        }

        .subtitle {
            font-size: 0.875rem;
            color: #6c757d;
            text-align: center;
        }

        .header-buttons {
            position: absolute;
            top: 0;
            right: 0;
            display: flex;
            gap: 0.5rem;
        }

        .audit-btn {
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 0.5rem 1rem;
            font-size: 0.875rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .audit-btn:hover {
            background: #f8f9fa;
            border-color: #d0d0d0;
        }

        .status-message {
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1.5rem;
            font-size: 0.875rem;
            font-weight: 500;
            display: none;
        }

        .status-message.show {
            display: block;
        }

        .status-message.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .status-message.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .form-section {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 1.5rem;
            border: 1px solid #e9ecef;
            margin-bottom: 1.5rem;
        }

        .phone-provider-section {
            background: #1a1d24;
            border: 1px solid #2d3139;
            color: #e9ecef;
        }

        .phone-provider-section .section-label {
            color: #e9ecef;
        }

        .section-header {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .section-label {
            font-size: 1rem;
            font-weight: 600;
            color: #1a1a1a;
        }

        .form-field {
            margin-bottom: 1rem;
        }

        label {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.875rem;
            font-weight: 500;
            color: #495057;
            margin-bottom: 0.5rem;
        }

        input, textarea, select {
            width: 100%;
            padding: 0.75rem 1rem;
            border: 1px solid #ced4da;
            border-radius: 8px;
            font-size: 0.875rem;
            color: #495057;
            background: white;
            font-family: inherit;
            transition: all 0.2s;
        }

        input:focus, textarea:focus, select:focus {
            outline: none;
            border-color: #8b5cf6;
            box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.1);
        }

        textarea {
            resize: vertical;
            min-height: 60px;
        }

        .two-column {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        /* Provider Options */
        .provider-hint {
            color: #adb5bd;
            font-size: 0.875rem;
            margin-bottom: 1rem;
        }

        .provider-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
        }

        .provider-btn {
            background: #2d3139;
            border: 2px solid #3d4149;
            border-radius: 8px;
            padding: 1rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.5rem;
            cursor: pointer;
            transition: all 0.2s;
            color: #e9ecef;
            font-size: 0.875rem;
            font-weight: 500;
        }

        .provider-btn:hover {
            background: #3d4149;
            border-color: #4d94ff;
            transform: translateY(-2px);
        }

        .provider-icon {
            font-size: 1.5rem;
        }

        .imported-phone-info {
            background: #2d3139;
            border-radius: 8px;
            padding: 1rem;
        }

        .phone-info-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            padding-bottom: 0.75rem;
            border-bottom: 1px solid #3d4149;
        }

        .provider-badge {
            background: #4d94ff;
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .change-provider-btn {
            background: transparent;
            border: 1px solid #4d94ff;
            color: #4d94ff;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            font-size: 0.75rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .change-provider-btn:hover {
            background: #4d94ff;
            color: white;
        }

        .phone-details {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .phone-detail-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .detail-label {
            color: #adb5bd;
            font-size: 0.875rem;
        }

        .detail-value {
            color: #e9ecef;
            font-size: 0.875rem;
            font-weight: 500;
        }

        /* Modal Styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.75);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            animation: fadeIn 0.2s ease-out;
        }

        .modal-overlay.hidden {
            display: none;
        }

        .modal-content {
            background: #1a1d24;
            border-radius: 12px;
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
            animation: slideUp 0.3s ease-out;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1.5rem;
            border-bottom: 1px solid #2d3139;
        }

        .modal-header h2 {
            font-size: 1.25rem;
            font-weight: 600;
            color: #e9ecef;
            margin: 0;
        }

        .modal-close {
            background: transparent;
            border: none;
            font-size: 2rem;
            color: #adb5bd;
            cursor: pointer;
            padding: 0;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 4px;
            transition: all 0.2s;
        }

        .modal-close:hover {
            background: #2d3139;
            color: #e9ecef;
        }

        .modal-body {
            padding: 1.5rem;
        }

        .modal-body .form-field label {
            color: #e9ecef;
        }

        .modal-body input,
        .modal-body select {
            background: #2d3139;
            border: 1px solid #3d4149;
            color: #e9ecef;
        }

        .modal-body input:focus,
        .modal-body select:focus {
            border-color: #4d94ff;
            box-shadow: 0 0 0 3px rgba(77, 148, 255, 0.1);
        }

        .modal-body input::placeholder {
            color: #6c757d;
        }

        .phone-input-group {
            display: flex;
            gap: 0.5rem;
        }

        .country-select {
            width: 120px;
            background: #2d3139;
            border: 1px solid #3d4149;
            color: #e9ecef;
            cursor: pointer;
        }

        .phone-input {
            flex: 1;
        }

        .checkbox-field {
            background: #2d3139;
            border-radius: 8px;
            padding: 1rem;
            border: 1px solid #3d4149;
        }

        .checkbox-label {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            cursor: pointer;
            color: #e9ecef;
            font-weight: 500;
            margin-bottom: 0.5rem;
        }

        .checkbox-label input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
            accent-color: #4d94ff;
        }

        .field-hint {
            color: #adb5bd;
            font-size: 0.75rem;
            margin: 0;
        }

        .modal-footer {
            display: flex;
            gap: 1rem;
            justify-content: flex-end;
            padding: 1.5rem;
            border-top: 1px solid #2d3139;
        }

        .btn {
            padding: 0.75rem 2rem;
            border-radius: 8px;
            font-size: 0.875rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            border: none;
        }

        .btn-cancel {
            background: white;
            color: #495057;
            border: 1px solid #ced4da;
        }

        .btn-cancel:hover:not(:disabled) {
            background: #f8f9fa;
            border-color: #adb5bd;
        }

        .btn-submit {
            background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
            color: white;
            box-shadow: 0 2px 4px rgba(139, 92, 246, 0.3);
        }

        .btn-submit:hover:not(:disabled) {
            background: linear-gradient(135deg, #7c3aed 0%, #6d28d9 100%);
            box-shadow: 0 4px 8px rgba(139, 92, 246, 0.4);
            transform: translateY(-1px);
        }

        .btn-import {
            background: linear-gradient(135deg, #4d94ff 0%, #3a7dd9 100%);
            color: white;
            box-shadow: 0 2px 4px rgba(77, 148, 255, 0.3);
        }

        .btn-import:hover {
            background: linear-gradient(135deg, #3a7dd9 0%, #2a6dc9 100%);
            box-shadow: 0 4px 8px rgba(77, 148, 255, 0.4);
            transform: translateY(-1px);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .form-actions {
            display: flex;
            gap: 1rem;
            justify-content: flex-end;
            margin-top: 1rem;
            padding-top: 1.5rem;
            border-top: 1px solid #e9ecef;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @media (max-width: 768px) {
            body {
                padding: 1rem;
            }
            
            .two-column {
                grid-template-columns: 1fr;
            }
            
            .header-buttons {
                position: static;
                margin-top: 1rem;
                width: 100%;
                justify-content: center;
            }
            
            .audit-btn {
                flex: 1;
            }

            .provider-buttons {
                grid-template-columns: 1fr;
            }

            .modal-content {
                width: 95%;
            }

            .phone-input-group {
                flex-direction: column;
            }

            .country-select {
                width: 100%;
            }
        }

        @media (max-width: 640px) {
            .form-actions {
                flex-direction: column-reverse;
            }

            .btn-cancel,
            .btn-submit {
                width: 100%;
            }

            .modal-footer {
                flex-direction: column;
            }

            .modal-footer .btn {
                width: 100%;
            }
        }

        .hidden {
            display: none !important;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Create AI Voice Agent</h1>
            <p class="subtitle">Customize voice tools, and personality for your AI-powered assistant</p>
            <div class="header-buttons">
                <button type="button" class="audit-btn" onclick="autofillForm()">‚ú® Autofill</button>
                <button type="button" class="audit-btn">üîç Audit</button>
            </div>
        </div>

        <div id="statusMessage" class="status-message"></div>

        <form id="voiceAgentForm">
            <!-- Agent Name -->
            <div class="form-section">
                <div class="section-header">
                    <span>ü§ñ</span>
                    <span class="section-label">Agent Name *</span>
                </div>
                <input type="text" name="agentName" placeholder="Ex. Sales Agent, Support Agent" required>
            </div>

            <!-- Company Information -->
            <div class="form-section">
                <div class="section-header">
                    <span>üè¢</span>
                    <span class="section-label">Company Information</span>
                </div>
                <div class="two-column">
                    <div class="form-field">
                        <label>üè¢ Company Name*</label>
                        <input type="text" name="companyName" placeholder="Enter your company name" required>
                    </div>
                    <div class="form-field">
                        <label>üåê Website URL *</label>
                        <input type="url" name="websiteUrl" placeholder="http://company.com" required>
                    </div>
                </div>
            </div>

            <!-- Goals & Context -->
            <div class="form-section">
                <div class="section-header">
                    <span>üéØ</span>
                    <span class="section-label">Goals & Context</span>
                </div>
                <div class="form-field">
                    <label>üéØ Goal*</label>
                    <textarea name="goal" placeholder="Ex. Conversation, Double property attendance, Schedule meeting" rows="3" required></textarea>
                </div>
                <div class="form-field">
                    <label>üìã Background Context*</label>
                    <textarea name="backgroundContext" placeholder="Describe history about your company, mission, or product." rows="4" required></textarea>
                </div>
            </div>

            <!-- Voice Configuration -->
            <div class="form-section">
                <div class="section-header">
                    <span>üéôÔ∏è</span>
                    <span class="section-label">Voice Configuration</span>
                </div>
                <div class="form-field">
                    <label>üí¨ Welcome Message*</label>
                    <textarea name="welcomeMessage" placeholder="Hello! How can I help you today?" rows="2" required></textarea>
                </div>
                <div class="form-field">
                    <label>üó£Ô∏è Instruction Voice*</label>
                    <textarea name="instructionVoice" placeholder="Describe the voice tone and style" rows="3" required></textarea>
                </div>
                <div class="form-field">
                    <label>üìù Script*</label>
                    <textarea name="script" placeholder="Drag file or type script for your agent." rows="5" required></textarea>
                </div>
            </div>

            <!-- Phone Provider Configuration -->
            <div class="form-section phone-provider-section">
                <div class="section-header">
                    <span>üìû</span>
                    <span class="section-label">Phone Number Options</span>
                </div>
                
                <div id="providerOptions" class="provider-options">
                    <p class="provider-hint">Import a phone number from your provider:</p>
                    <div class="provider-buttons">
                        <button type="button" class="provider-btn" onclick="openProviderModal('twilio')">
                            <span class="provider-icon">üì±</span>
                            <span>Import Twilio</span>
                        </button>
                        <button type="button" class="provider-btn" onclick="openProviderModal('vonage')">
                            <span class="provider-icon">üìû</span>
                            <span>Import Vonage</span>
                        </button>
                        <button type="button" class="provider-btn" onclick="openProviderModal('telnyx')">
                            <span class="provider-icon">‚òéÔ∏è</span>
                            <span>Import Telnyx</span>
                        </button>
                    </div>
                </div>

                <div id="importedPhoneInfo" class="imported-phone-info hidden">
                    <div class="phone-info-header">
                        <span id="providerBadge" class="provider-badge"></span>
                        <button type="button" class="change-provider-btn" onclick="changeProvider()">
                            Change Provider
                        </button>
                    </div>
                    <div class="phone-details" id="phoneDetails"></div>
                </div>
            </div>

            <!-- Agent Settings -->
            <div class="form-section">
                <div class="section-header">
                    <span>‚öôÔ∏è</span>
                    <span class="section-label">Agent Settings</span>
                </div>
                <div class="two-column">
                    <div class="form-field">
                        <label>üåê Language *</label>
                        <select name="language" required>
                            <option value="en-US">English</option>
                            <option value="es-ES">Spanish</option>
                            <option value="fr-FR">French</option>
                            <option value="de-DE">German</option>
                            <option value="zh-CN">Chinese</option>
                        </select>
                    </div>
                    <div class="form-field">
                        <label>üïê Timezone *</label>
                        <select name="timezone" required>
                            <option value="">Select timezone</option>
                            <option value="America/New_York">Eastern Time (ET)</option>
                            <option value="America/Chicago">Central Time (CT)</option>
                            <option value="America/Denver">Mountain Time (MT)</option>
                            <option value="America/Los_Angeles">Pacific Time (PT)</option>
                            <option value="UTC">UTC</option>
                        </select>
                    </div>
                </div>
                <div class="two-column">
                    <div class="form-field">
                        <label>ü§ñ Select agent type *</label>
                        <select name="agentType" required>
                            <option value="">Select agent type</option>
                            <option value="sales">Sales Agent</option>
                            <option value="support">Support Agent</option>
                            <option value="booking">Booking Agent</option>
                            <option value="general">General Assistant</option>
                        </select>
                    </div>
                    <div class="form-field">
                        <label>üõ†Ô∏è Select tool *</label>
                        <select name="tool" required>
                            <option value="">Select tool</option>
                            <option value="calendar">Calendar Integration</option>
                            <option value="crm">CRM Integration</option>
                            <option value="email">Email Integration</option>
                            <option value="sms">SMS Integration</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="form-actions">
                <button type="button" class="btn btn-cancel" onclick="resetForm()">Cancel</button>
                <button type="submit" class="btn btn-submit">Create Agent</button>
            </div>
        </form>
    </div>

    <!-- Provider Import Modal -->
    <div id="providerModal" class="modal-overlay hidden">
        <div class="modal-content" onclick="event.stopPropagation()">
            <div class="modal-header">
                <h2 id="modalTitle">Import Phone Number</h2>
                <button class="modal-close" onclick="closeProviderModal()">√ó</button>
            </div>

            <div class="modal-body">
                <div class="form-field">
                    <label id="phoneLabel">üì± Phone Number *</label>
                    <div class="phone-input-group">
                        <select id="countryCode" class="country-select">
                            <option value="+1">üá∫üá∏ +1</option>
                            <option value="+44">üá¨üáß +44</option>
                            <option value="+91">üáÆüá≥ +91</option>
                            <option value="+92">üáµüá∞ +92</option>
                            <option value="+971">üá¶üá™ +971</option>
                        </select>
                        <input type="tel" id="phoneNumber" class="phone-input" placeholder="4156051922">
                    </div>
                </div>

                <!-- Twilio Fields -->
                <div id="twilioFields" class="hidden">
                    <div class="form-field">
                        <label>üîë Twilio Account SID *</label>
                        <input type="text" id="twilioSid" placeholder="Twilio Account SID">
                    </div>
                    <div class="form-field">
                        <label>üîê Twilio Auth Token *</label>
                        <input type="password" id="twilioAuthToken" placeholder="Twilio Auth Token">
                    </div>
                    <div class="form-field">
                        <label>üè∑Ô∏è Label</label>
                        <input type="text" id="twilioLabel" placeholder="Label for Phone Number">
                    </div>
                    <div class="form-field checkbox-field">
                        <label class="checkbox-label">
                            <input type="checkbox" id="smsEnabled" checked>
                            <span>SMS Enabled</span>
                        </label>
                        <p class="field-hint">Enable SMS messaging for this phone number</p>
                    </div>
                </div>

                <!-- Vonage Fields -->
                <div id="vonageFields" class="hidden">
                    <div class="form-field">
                        <label>üîë API Key *</label>
                        <input type="text" id="vonageApiKey" placeholder="Enter API Key">
                    </div>
                    <div class="form-field">
                        <label>üîê API Secret *</label>
                        <input type="password" id="vonageApiSecret" placeholder="Enter API Secret">
                    </div>
                    <div class="form-field">
                        <label>üè∑Ô∏è Label</label>
                        <input type="text" id="vonageLabel" placeholder="Label for Phone Number">
                    </div>
                </div>

                <!-- Telnyx Fields -->
                <div id="telnyxFields" class="hidden">
                    <div class="form-field">
                        <label>üîë API Key *</label>
                        <input type="text" id="telnyxApiKey" placeholder="Enter API Key">
                    </div>
                    <div class="form-field">
                        <label>üè∑Ô∏è Label</label>
                        <input type="text" id="telnyxLabel" placeholder="Label for Phone Number">
                    </div>
                </div>
            </div>

            <div class="modal-footer">
                <button type="button" class="btn btn-cancel" onclick="closeProviderModal()">Cancel</button>
                <button type="button" class="btn btn-import" onclick="handleProviderImport()">
                    Import from <span id="providerName"></span>
                </button>
            </div>
        </div>
    </div>

    <script>
        const form = document.getElementById('voiceAgentForm');
        const statusMessage = document.getElementById('statusMessage');
        let currentProvider = '';
        let phoneProviderData = {};

        function generateUUID() {
            return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
                const r = Math.random() * 16 | 0;
                const v = c === 'x' ? r : (r & 0x3 | 0x8);
                return v.toString(16);
            });
        }

        function openProviderModal(provider) {
            currentProvider = provider;
            const modal = document.getElementById('providerModal');
            const modalTitle = document.getElementById('modalTitle');
            const phoneLabel = document.getElementById('phoneLabel');
            const providerName = document.getElementById('providerName');
            
            // Hide all provider fields
            document.getElementById('twilioFields').classList.add('hidden');
            document.getElementById('vonageFields').classList.add('hidden');
            document.getElementById('telnyxFields').classList.add('hidden');
            
            // Update modal title and show relevant fields
            if (provider === 'twilio') {
                modalTitle.textContent = 'Import Twilio Number';
                phoneLabel.textContent = 'üì± Twilio Phone Number *';
                providerName.textContent = 'Twilio';
                document.getElementById('twilioFields').classList.remove('hidden');
            } else if (provider === 'vonage') {
                modalTitle.textContent = 'Import Vonage Number';
                phoneLabel.textContent = 'üìû Vonage Phone Number *';
                providerName.textContent = 'Vonage';
                document.getElementById('vonageFields').classList.remove('hidden');
            } else if (provider === 'telnyx') {
                modalTitle.textContent = 'Import Telnyx Number';
                phoneLabel.textContent = '‚òéÔ∏è Telnyx Phone Number *';
                providerName.textContent = 'Telnyx';
                document.getElementById('telnyxFields').classList.remove('hidden');
            }
            
            modal.classList.remove('hidden');
        }

        function closeProviderModal() {
            document.getElementById('providerModal').classList.add('hidden');
            // Clear form
            document.getElementById('phoneNumber').value = '';
            document.getElementById('twilioSid').value = '';
            document.getElementById('twilioAuthToken').value = '';
            document.getElementById('twilioLabel').value = '';
            document.getElementById('vonageApiKey').value = '';
            document.getElementById('vonageApiSecret').value = '';
            document.getElementById('vonageLabel').value = '';
            document.getElementById('telnyxApiKey').value = '';
            document.getElementById('telnyxLabel').value = '';
        }

        function handleProviderImport() {
            const countryCode = document.getElementById('countryCode').value;
            const phoneNumber = document.getElementById('phoneNumber').value;
            
            if (!phoneNumber) {
                showStatus('error', 'Please enter a phone number');
                return;
            }

            phoneProviderData = {
                provider: currentProvider,
                phoneNumber: countryCode + phoneNumber.replace(/\D/g, ''),
                countryCode: countryCode
            };

            if (currentProvider === 'twilio') {
                const sid = document.getElementById('twilioSid').value;
                const token = document.getElementById('twilioAuthToken').value;
                const label = document.getElementById('twilioLabel').value;
                const smsEnabled = document.getElementById('smsEnabled').checked;

                if (!sid || !token) {
                    showStatus('error', 'Please fill all required Twilio fields');
                    return;
                }

                phoneProviderData.twilioSid = sid;
                phoneProviderData.twilioAuthToken = token;
                phoneProviderData.label = label;
                phoneProviderData.smsEnabled = smsEnabled;
            } else if (currentProvider === 'vonage') {
                const apiKey = document.getElementById('vonageApiKey').value;
                const apiSecret = document.getElementById('vonageApiSecret').value;
                const label = document.getElementById('vonageLabel').value;

                if (!apiKey || !apiSecret) {
                    showStatus('error', 'Please fill all required Vonage fields');
                    return;
                }

                phoneProviderData.vonageApiKey = apiKey;
                phoneProviderData.vonageApiSecret = apiSecret;
                phoneProviderData.label = label;
            } else if (currentProvider === 'telnyx') {
                const apiKey = document.getElementById('telnyxApiKey').value;
                const label = document.getElementById('telnyxLabel').value;

                if (!apiKey) {
                    showStatus('error', 'Please fill all required Telnyx fields');
                    return;
                }

                phoneProviderData.telnyxApiKey = apiKey;
                phoneProviderData.label = label;
            }

            // Show imported info
            displayImportedPhone();
            closeProviderModal();
            showStatus('success', `${currentProvider.charAt(0).toUpperCase() + currentProvider.slice(1)} number imported successfully!`);
        }

        function displayImportedPhone() {
            document.getElementById('providerOptions').classList.add('hidden');
            document.getElementById('importedPhoneInfo').classList.remove('hidden');
            
            const badge = document.getElementById('providerBadge');
            badge.textContent = phoneProviderData.provider;
            
            let detailsHTML = `
                <div class="phone-detail-row">
                    <span class="detail-label">Phone Number:</span>
                    <span class="detail-value">${phoneProviderData.phoneNumber}</span>
                </div>
            `;
            
            if (phoneProviderData.label) {
                detailsHTML += `
                    <div class="phone-detail-row">
                        <span class="detail-label">Label:</span>
                        <span class="detail-value">${phoneProviderData.label}</span>
                    </div>
                `;
            }
            
            if (phoneProviderData.provider === 'twilio' && phoneProviderData.smsEnabled) {
                detailsHTML += `
                    <div class="phone-detail-row">
                        <span class="detail-label">SMS:</span>
                        <span class="detail-value">‚úÖ Enabled</span>
                    </div>
                `;
            }
            
            document.getElementById('phoneDetails').innerHTML = detailsHTML;
        }

        function changeProvider() {
            document.getElementById('providerOptions').classList.remove('hidden');
            document.getElementById('importedPhoneInfo').classList.add('hidden');
            phoneProviderData = {};
        }

        function autofillForm() {
            form.agentName.value = 'julie2';
            form.companyName.value = 'EduCare';
            form.websiteUrl.value = 'https://educare.com';
            form.goal.value = 'The core business goal, in order of priority, is:\n\nConvert inbound inquiries into booked trial classes\n\nCapture and validate lead information step-by-step\n\nDeliver trial classes as the primary conversion mechanism';
            form.backgroundContext.value = 'EduCare is positioned as an online live tuition platform that provides:\n\nDedicated 1-to-1 or live online classes\n\nAcademic and professional subject tutoring\n\nServices delivered through human-like inbound voice support';
            form.welcomeMessage.value = 'Hi, thank you for calling our online tuition support line‚Ä¶ this is EduCare. How can I help you today?';
            form.instructionVoice.value = 'Be friendly, professional, and helpful. Listen carefully to the caller\'s needs and provide accurate information.';
            form.script.value = 'You are **EduCare**, a **human‚Äësounding inbound voice agent** for an **online live tuition platform**.';
            form.language.value = 'en-US';
            form.timezone.value = 'America/New_York';
            form.agentType.value = 'sales';
            form.tool.value = 'calendar';

            // Autofill phone provider
            phoneProviderData = {
                provider: 'twilio',
                phoneNumber: '+15076051169',
                countryCode: '+1',
                twilioSid: 'YOUR_TWILIO_ACCOUNT_SID',
                twilioAuthToken: '58ce8f7af58a9e9278f05a6f13022a32',
                label: 'Main Support Line',
                smsEnabled: true
            };
            currentProvider = 'twilio';
            displayImportedPhone();
            
            statusMessage.className = 'status-message';
        }

        function showStatus(type, message) {
            statusMessage.textContent = message;
            statusMessage.className = `status-message ${type} show`;
        }

        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            if (!phoneProviderData.provider || !phoneProviderData.phoneNumber) {
                showStatus('error', 'Please import a phone number before creating the agent');
                return;
            }

            const formData = new FormData(form);
            const currentTime = new Date().toISOString();
            
            // Prepare complete webhook payload
            const webhookPayload = {
                id: generateUUID(),
                owner_user_id: generateUUID(),
                name: formData.get('agentName'),
                company_name: formData.get('companyName'),
                website_url: formData.get('websiteUrl'),
                goal: formData.get('goal'),
                background: formData.get('backgroundContext'),
                welcome_message: formData.get('welcomeMessage'),
                instruction_voice: formData.get('instructionVoice'),
                script: formData.get('script'),
                voice: 'aura-helena-en',
                language: formData.get('language'),
                agent_type: formData.get('agentType'),
                tone: 'professional',
                model: 'gpt-4o',
                background_noise: 'office',
                max_timeout: null,
                created_at: currentTime,
                updated_at: currentTime,
                vapi_id: null,
                vapi_account_assigned: 2,
                account_in_use: false,
                voice_provider: 'deepgram',
                executionMode: 'production',
                phoneProvider: phoneProviderData.provider,
                phoneNumber: phoneProviderData.phoneNumber,
                phoneLabel: phoneProviderData.label || ''
            };

            // Add provider-specific fields
            if (phoneProviderData.provider === 'twilio') {
                webhookPayload.twilioSid = phoneProviderData.twilioSid;
                webhookPayload.twilioAuthToken = phoneProviderData.twilioAuthToken;
                webhookPayload.smsEnabled = phoneProviderData.smsEnabled;
            } else if (phoneProviderData.provider === 'vonage') {
                webhookPayload.vonageApiKey = phoneProviderData.vonageApiKey;
                webhookPayload.vonageApiSecret = phoneProviderData.vonageApiSecret;
            } else if (phoneProviderData.provider === 'telnyx') {
                webhookPayload.telnyxApiKey = phoneProviderData.telnyxApiKey;
            }

            // Show loading state
            const submitBtn = form.querySelector('.btn-submit');
            const originalText = submitBtn.textContent;
            submitBtn.textContent = 'Creating...';
            submitBtn.disabled = true;

            try {
                const response = await fetch('https://auto.nsolbpo.com/webhook/e316ca21-61d3-44c6-8ae6-319604437b05', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(webhookPayload)
                });

                if (response.ok) {
                    showStatus('success', 'Agent created successfully!');
                    console.log('Webhook response:', await response.json());
                } else {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
            } catch (error) {
                console.error('Error:', error);
                showStatus('error', 'Failed to create agent. Please try again.');
            } finally {
                submitBtn.textContent = originalText;
                submitBtn.disabled = false;
            }
        });

        function resetForm() {
            form.reset();
            changeProvider();
            statusMessage.className = 'status-message';
        }

        // Close modal when clicking outside
        document.getElementById('providerModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeProviderModal();
            }
        });
    </script>
</body>
</html>
